<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>Lifestyle Shirva - Scratch & Win</title>
<style>
/* ===== General Body ===== */
body, html {
    margin: 0;
    padding: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    height: 100vh;
    width: 100vw;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    background: #f0f0f0;
}
/* ===== Header ===== */
header {
    background: #4CAF50;
    color: white;
    padding: 15px;
    width: 100%;
    text-align: center;
    font-size: 1.8rem;
    font-weight: bold;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}
/* ===== Dashboard / First Screen ===== */
.dashboard {
    background: white;
    padding: 15px;
    border-radius: 16px;
    width: 95%;
    max-width: 360px;
    text-align: center;
    margin-top: 20px;
    flex-shrink: 0;
}
.dashboard input {
    width: 100%;
    padding: 12px;
    margin: 8px 0;
    font-size: 1rem;
    border-radius: 10px;
    border: 1px solid #ccc;
    box-sizing: border-box;
}
.dashboard input:focus {
    border: 1px solid #4CAF50;
    box-shadow: 0 0 6px rgba(76, 175, 80, 0.4);
}
.dashboard button {
    width: 100%;
    padding: 14px;
    font-size: 1.1rem;
    border-radius: 10px;
    margin-top: 10px;
    border: none;
    color: white;
    background: #4CAF50;
    cursor: pointer;
    font-weight: bold;
}
.dashboard button:hover { background: #45a049; }
.message { margin-top: 10px; font-weight: bold; font-size: 0.9rem; }
.error { color: red; }
.success { color: green; }
/* ===== First Screen Condition Box ===== */
#firstScreenConditionBox {
    display:none;
    margin-top: 15px;
    padding: 12px;
    background: #FFF8DC;
    border: 2px solid #FFD700;
    border-radius: 12px;
    font-size: 0.9rem;
    text-align: left;
    line-height: 1.5;
}
#firstScreenConditionBox span { display:block; }
/* ===== Terms & Conditions (First Screen Only) ===== */
#termsAndConditions {
    width: 95%;
    max-width: 360px;
    margin: 10px auto;
    padding: 12px;
    background: #f9f9f9;
    border: 1px solid #ddd;
    border-radius: 12px;
    font-size: 0.8rem;
    line-height: 1.4;
    color: #333;
    overflow-y: auto;
    max-height: 20vh;
}
/* ===== Second Screen ===== */
.scratch-container {
    position: relative;
    width: 100%;
    max-width: 420px;
    background: radial-gradient(circle, #FFFAF0, #FF6347);
    border-radius: 20px;
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    padding: 15px;
    box-sizing: border-box;
    flex-shrink: 0;
}
/* Header Text */
.header-text {
    font-size: 3rem;
    font-weight: bold;
    color: #FFD700;
    text-align: center;
    text-shadow: 1px 1px 3px #000;
    animation: grandBlink .5s infinite;
    margin-bottom: 10px;
}
@keyframes grandBlink {
    0%,100%{ color:#FFD700; transform:scale(1); text-shadow:0 0 5px #FFD700; }
    50%{ color:#FF4500; transform:scale(1.1); text-shadow:0 0 10px #FF4500; }
}
/* Circle Scratch Canvas */
#scratchCanvas {
    width: 90vw;
    max-width: 320px;
    aspect-ratio: 1/1;
    border-radius: 50%;
    display: block;
    margin: px auto;
    touch-action: none;
    position: relative;
    z-index: 2;
}
#offer {
    position:absolute;
    width:90vw;
    max-width:320px;
    aspect-ratio:1/1;
    top:0;
    left:50%;
    transform:translateX(-50%);
    display:flex;
    align-items:center;
    justify-content:center;
    text-align:center;
    background:#FFF8DC;
    border-radius:50%;
    font-weight:bold;
    font-size:3rem;
    color:#333;
    padding:10px;
    box-sizing:border-box;
    z-index:1;
}
#afterScratchConditionBox #winningInfo {
    font-size: 1.5rem;     
    font-weight: bold;      
    color: #FF4500;         
    text-shadow: 1px 1px 5px #FFD700; 
    margin: 15px 0;         
}
/* Footer and Lamps */
.lamp-container { width:100%; display:flex; justify-content:space-around; margin-top:10px; }
.lamp { width:25px; height:25px; background: radial-gradient(circle,#FFD700 60%,#FF8C00 100%); border-radius:50%; box-shadow:0 0 10px #FFD700; }
.footer-text { text-align:center; font-size:.7rem; color:#5C4033; font-weight:bold; text-shadow:1px 1px 2px #000; margin-top:10px; }
.blinking { animation: grandBlink .5s infinite; }
/* After Scratch Condition Box */
#afterScratchConditionBox {
    display:none;
    position:fixed;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    padding:25px;
    background:#fff;
    border:4px solid #FFD700;
    border-radius:15px;
    text-align:center;
    z-index:9999;
    width:90%;
    max-width:350px;
    box-sizing:border-box;
}
#afterScratchConditionBox span { display:block; margin:10px 0; font-size:0.9rem; }
/* Celebration */
.celebration { position:fixed; top:0; left:0; width:100vw; height:100vh; pointer-events:none; overflow:hidden; z-index:9999; display:none; background:transparent; }
.particle { position:absolute; font-size:1.5rem; opacity:1; animation: realisticFly 5s ease-out forwards; }
@keyframes realisticFly {
    0% {transform:translate(0,0) scale(1);opacity:1;}
    50% {transform:translate(var(--x),var(--y)) scale(1.3);opacity:0.8;}
    100% {transform:translate(calc(var(--x)*1.5),calc(var(--y)*1.5)) scale(1.6);opacity:0;}
}
</style>
</head>
<body>

<header>Welcome To Lifestyle Shirva!</header>

<!-- First Screen -->
<div class="dashboard" id="firstScreen">
    <!-- BillNo + Load Button row -->
  <div style="display:flex; gap:8px; align-items:center;">
  <input type="text" id="billNo" placeholder="Enter Your Bill Number"
         style="flex:1; padding:14px; font-size:1rem; border-radius:10px; border:1px solid #ccc; box-sizing:border-box;">
  <button onclick="loadDetails()" 
          style="padding:14px 20px; font-size:1rem; border-radius:10px; border:none; background:#4CAF50; color:white; font-weight:bold; cursor:pointer; white-space:nowrap;">
      Load
  </button>
</div>

    <input type="text" id="name" placeholder="Customer Name" readonly>
    <input type="text" id="mobile" placeholder="Mobile Number" readonly>
    <input type="text" id="billAmt" placeholder="Bill Amount" readonly>
    <button id="proceedBtn" onclick="proceed()">Proceed</button>
    <div id="msg" class="message"></div>

    <div id="firstScreenConditionBox">
        <span id="condCustName">Customer: </span>
        <span id="condBillNo">Bill Number: </span>
        <span id="condBillAmt">Bill Amount: </span>
        <span id="condCouponCode">Coupon Code: </span>
        <span id="condWinningGift">Winning Gift: </span>
    </div>

    <div id="termsAndConditions">
        * Scratch Card is valid only on purchases above ‚Çπ1000.<br>
        * Scratch Card is valid for 10 days only.<br>
        * Each customer can use only one scratch card per purchase.<br>
        * Take a screenshot of the result.<br>
        * No exchange. Scratch card is final.<br>
        * Scratch cards are non-transferable & non-exchangeable
    </div>
</div>

<!-- Second Screen -->
<div class="scratch-container" id="secondScreen">
    <div class="header-text">Scratch & WinüèÜ</div>
    <div style="position:relative;">
        <canvas id="scratchCanvas" width="300" height="300"></canvas>
        <div id="offer"></div>
    </div>
    <div class="lamp-container">
        <div class="lamp"></div><div class="lamp"></div>
    </div>
    <div class="footer-text">¬© 2025 Life Style Shirva üíñ</div>

    <div id="afterScratchConditionBox">
        <h1 class="blinking">üåüüí∞ Congratulations! üèÜ üåü</h1>
        <span id="afterCustName">Customer: </span>
        <span id="afterBillNo">Bill Number: </span>
        <span id="afterBillAmt">Bill Amount: </span>
        <span id="winningInfo">You Won: XXXXXXX</span>
        <span id="couponCodeInfo">Code: ABCD-XXXX-XXXX</span>
        <span id="scratchDateTime">Date & Time: DD-MM-YYYY</span>
        <a href="#" id="whatsappButton" style="background:green;color:white;padding:12px 30px;border-radius:8px;text-decoration:none;display:inline-block;margin-top:10px;">Send to WhatsApp</a>
    </div>

    <div class="celebration" id="celebrationContainer"></div>
</div>

<script>
// ===== LocalStorage for used bills =====
let usedBills = JSON.parse(localStorage.getItem('usedBills') || '[]');
function saveUsedBills(){ localStorage.setItem('usedBills', JSON.stringify(usedBills)); }

// ===== Fetch JSON =====
async function getCustomerData(billNo){
  const res = await fetch("https://bill-4rh.pages.dev/bills.json");
  const data = await res.json();
  const bills = data.bills || data;
  return bills.find(c => c.billNo === billNo);
}

let currentCustomer = null;

async function loadDetails(){
    const billNo = document.getElementById('billNo').value.trim();
    const msg = document.getElementById('msg');
    msg.innerHTML=""; msg.className="message";

    if(!billNo){ msg.innerHTML="‚ö†Ô∏è Bill Number ‡≤¨‡≥á‡≤ï‡≥Å!"; msg.classList.add("error"); return; }

    const customer = await getCustomerData(billNo);
    if(!customer){ msg.innerHTML="‚ùå Bill Number not found"; msg.classList.add("error"); return; }

    currentCustomer = customer;
    document.getElementById('name').value = customer.name || "Customer";
    document.getElementById('mobile').value = customer.mobile || "-";
    document.getElementById('billAmt').value = customer.payable || customer.amount || "0";
    msg.innerHTML="‚úÖ Details loaded. Now press Proceed."; msg.classList.add("success");
}

// ===== Proceed Logic =====
function proceed() {
    const msg = document.getElementById('msg');
    const condBox = document.getElementById('firstScreenConditionBox');
    msg.innerHTML=""; msg.className="message";

    if(!currentCustomer){ 
        msg.innerHTML="‚ö†Ô∏è Please load details first!"; 
        msg.classList.add("error"); 
        return; 
    }

    const billNo = currentCustomer.billNo;
    const name = currentCustomer.name || "Customer";
    const billAmt = parseFloat(currentCustomer.payable || currentCustomer.amount || 0);

    const used = usedBills.find(b=>b.billNo===billNo);
    if(used){
        msg.innerHTML="‚ùå Already used!";
        msg.classList.add("error");
        condBox.style.display='block';
        document.getElementById('condCustName').innerText=`Customer Name: ${used.name}`;
        document.getElementById('condBillNo').innerText=`Bill Number: ${used.billNo}`;
        document.getElementById('condBillAmt').innerText=`Bill Amount: ‚Çπ${used.billAmt}`;
        document.getElementById('condCouponCode').innerText=`Coupon Code: ${used.coupon || '-'}`;
        document.getElementById('condWinningGift').innerText=`Winning Gift: ${used.gift || '-'}`;
        return;
    }

    usedBills.push({billNo,name,billAmt,gift:null,coupon:null}); 
    saveUsedBills();

    document.getElementById('firstScreen').style.display="none";
    document.getElementById('secondScreen').style.display="flex";
}

// ===== Scratch Logic =====
const canvas = document.getElementById('scratchCanvas');
const ctx = canvas.getContext('2d');
const offer = document.getElementById('offer');
let isDrawing=false, scratchActions=0, revealed=false;

function getPointerPos(e){ const rect=canvas.getBoundingClientRect(); return {x:(e.touches?e.touches[0].clientX:e.clientX)-rect.left, y:(e.touches?e.touches[0].clientY:e.clientX)-rect.left}; }
function scratch(e){ const pos=getPointerPos(e); ctx.globalCompositeOperation='destination-out'; ctx.beginPath(); ctx.arc(pos.x,pos.y,20,0,Math.PI*2); ctx.fill(); }
function startScratch(e){ if(revealed) return; isDrawing=true; }
function performScratch(e){ if(!isDrawing || revealed) return; scratch(e); }
function endScratch(e){
    if(!revealed && isDrawing){
        scratchActions++; 
        if(scratchActions>=1){ 
            startCelebrationAndAfterBox();
        }
    }
    isDrawing=false;
}
function generateCouponCode(){ return 'LS-'+Math.random().toString(36).substring(2,10).toUpperCase(); }
function getCurrentDateTime(){ return new Date().toLocaleString(); }
function updateWhatsAppButton(randomGift, couponCode, dateTime){
    const name = currentCustomer?.name || "Customer";
    const billNo = currentCustomer?.billNo || "-";
    const billAmt = currentCustomer?.payable || currentCustomer?.amount || "0";
    const message=`Hi Life Style Shirva Team.
I am very happy with this Scratch & Win Card.\n\nCustomer Name: ${name}\nBill No: ${billNo}\nBill Amount: ‚Çπ${billAmt}\nWinning Prize: ${randomGift}\nCard No: ${couponCode}\nDate & Time: ${dateTime}`;
    const encodedMessage=encodeURIComponent(message);
    document.getElementById('whatsappButton').href=`https://wa.me/918431270716?text=${encodedMessage}`;
}
function startCelebrationAndAfterBox(){
    const billAmt = parseFloat(currentCustomer?.payable || currentCustomer?.amount || 0);
    let gifts=[];
    if(billAmt>=1000 && billAmt<1500) gifts=['üí∞30 ‚Çπ Cashback','üí∞40 ‚Çπ Cashback','üí∞50 ‚Çπ Cashback'];
    else if(billAmt>=1500 && billAmt<2000) gifts=['üí∞20 ‚Çπ Cashback','üí∞30 ‚Çπ Cashback','üí∞40 ‚Çπ Cashback','üí∞50 ‚Çπ Cashback'];
    else if(billAmt>=2000 && billAmt<2500) gifts=['üí∞30 ‚Çπ Cashback','üí∞40 ‚Çπ Cashback','üí∞50 ‚Çπ Cashback','üí∞60 ‚Çπ Cashback'];
    else if(billAmt>=2500 && billAmt<3000) gifts=['üí∞40 ‚Çπ Cashback','üí∞50 ‚Çπ Cashback','üí∞70 ‚Çπ Cashback','üí∞80 ‚Çπ Cashback'];
    else if(billAmt>=3000 && billAmt<3500) gifts=['üí∞50 ‚Çπ Cashback','üí∞70 ‚Çπ Cashback','üí∞80 ‚Çπ Cashback','üí∞90 ‚Çπ Cashback'];
    else if(billAmt>=3500 && billAmt<4000) gifts=['üí∞60 ‚Çπ Cashback','üí∞80 ‚Çπ Cashback','üí∞90 ‚Çπ Cashback','üí∞100 ‚Çπ Cashback'];
    else if(billAmt>=4000 && billAmt<4500) gifts=['üí∞70 ‚Çπ Cashback','üí∞90 ‚Çπ Cashback','üí∞100 ‚Çπ Cashback','üí∞120 ‚Çπ Cashback'];
    else if(billAmt>=4500 && billAmt<5000) gifts=['üí∞80 ‚Çπ Cashback','üí∞100 ‚Çπ Cashback','üí∞120 ‚Çπ Cashback','üí∞150 ‚Çπ Cashback'];
    else if(billAmt>=5000) gifts=['üí∞90 ‚Çπ Cashback','üí∞100 ‚Çπ Cashback','üí∞150 ‚Çπ Cashback','üí∞200 ‚Çπ Cashback'];
    const randomGift = gifts[Math.floor(Math.random()*gifts.length)];
    revealFull(randomGift);
}
function revealFull(randomGift){
    revealed=true; ctx.clearRect(0,0,canvas.width,canvas.height); offer.innerText=randomGift; offer.style.display='flex';
    setTimeout(()=>{
        const name = currentCustomer?.name || "Customer";
        const billNo = currentCustomer?.billNo || "-";
        const billAmt = currentCustomer?.payable || currentCustomer?.amount || "0";
        if(randomGift!=='üò¢ Better luck next time'){
            const code=generateCouponCode(); 
            const dateTime=getCurrentDateTime();
            document.getElementById('afterCustName').innerText=`Customer Name: ${name}`;
            document.getElementById('afterBillNo').innerText=`Bill Number: ${billNo}`;
            document.getElementById('afterBillAmt').innerText=`Bill Amount: ‚Çπ${billAmt}`;
            document.getElementById('winningInfo').innerText=`You Won: ${randomGift}`;
            document.getElementById('couponCodeInfo').innerText=`Code: ${code}`;
            document.getElementById('scratchDateTime').innerText=`Date & Time: ${dateTime}`;
            document.getElementById('afterScratchConditionBox').style.display='block';
            updateWhatsAppButton(randomGift,code,dateTime);
            const used = usedBills.find(b=>b.billNo===billNo);
            if(used){ 
                used.gift=randomGift; 
                used.coupon=code; 
                saveUsedBills();
                document.getElementById('condCouponCode').innerText=`Coupon Code: ${code}`;
                document.getElementById('condWinningGift').innerText=`Winning Gift: ${randomGift}`;
            }
            const celebrationContainer=document.getElementById('celebrationContainer'); 
            celebrationContainer.innerHTML='';
            const particles=['üå∏','‚ú®','üéâ','üí•','üåü','üí´','üåü','‚ú®','‚ö°'];
            for(let i=0;i<60;i++){ 
                const span=document.createElement('span'); 
                span.className='particle';
                span.innerText=particles[Math.floor(Math.random()*particles.length)];
                span.style.left=Math.random()*window.innerWidth+'px';
                span.style.top=Math.random()*window.innerHeight+'px';
                span.style.setProperty('--x',(Math.random()-0.5)*600+'px');
                span.style.setProperty('--y',(Math.random()-0.5)*600+'px');
                span.style.animationDelay=Math.random()+'s'; 
                celebrationContainer.appendChild(span);
            } 
            celebrationContainer.style.display='block'; 
            setTimeout(()=>{celebrationContainer.style.display='none';},5000);
        } else { offer.innerText='üò¢ Better luck next time.'; } 
    },1000);
}
// Initialize scratch overlay
ctx.fillStyle='silver'; 
ctx.fillRect(0,0,canvas.width,canvas.height);
ctx.font='bold 18px Arial'; 
ctx.fillStyle='black'; 
ctx.textAlign='center';
ctx.fillText('SCRATCH HERE üéâ',canvas.width/2,canvas.height/2);
canvas.addEventListener('pointerdown', startScratch); 
canvas.addEventListener('pointermove', performScratch);
canvas.addEventListener('pointerup', endScratch); 
</script>
</body>
</html>

