<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
<title>Lifestyle Shirva - Scratch & Win</title>
<style>
/* ===== General Body ===== */
body, html {
    margin: 0;
    padding: 0;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    height: 100vh;
    width: 100vw;
    overflow: hidden;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: flex-start;
    background: #f0f0f0;
}
header {
    background: #4CAF50;
    color: white;
    padding: 15px;
    width: 100%;
    text-align: center;
    font-size: 1.8rem;
    font-weight: bold;
    box-shadow: 0 4px 8px rgba(0,0,0,0.2);
}
.dashboard {
    background: white;
    padding: 15px;
    border-radius: 16px;
    width: 95%;
    max-width: 360px;
    text-align: center;
    margin-top: 20px;
    flex-shrink: 0;
}
.dashboard input {
    width: 100%;
    padding: 12px;
    margin: 8px 0;
    font-size: 1rem;
    border-radius: 10px;
    border: 1px solid #ccc;
    box-sizing: border-box;
}
.dashboard button {
    width: 100%;
    padding: 14px;
    font-size: 1.1rem;
    border-radius: 10px;
    margin-top: 10px;
    border: none;
    color: white;
    background: #4CAF50;
    cursor: pointer;
    font-weight: bold;
}
.message { margin-top: 10px; font-weight: bold; font-size: 0.9rem; }
.error { color: red; }
.success { color: green; }
#firstScreenConditionBox {
    display:none;
    margin-top: 15px;
    padding: 12px;
    background: #FFF8DC;
    border: 2px solid #FFD700;
    border-radius: 12px;
    font-size: 0.9rem;
    text-align: left;
}
#termsAndConditions {
    width: 95%;
    max-width: 360px;
    margin: 10px auto;
    padding: 12px;
    background: #f9f9f9;
    border: 1px solid #ddd;
    border-radius: 12px;
    font-size: 0.8rem;
    line-height: 1.4;
    color: #333;
}
.scratch-container {
    position: relative;
    width: 100%;
    max-width: 420px;
    background: radial-gradient(circle, #FFFAF0, #FF6347);
    border-radius: 20px;
    display: none;
    flex-direction: column;
    align-items: center;
    padding: 15px;
}
.header-text {
    font-size: 3rem;
    font-weight: bold;
    color: #FFD700;
    text-shadow: 1px 1px 3px #000;
    animation: grandBlink .5s infinite;
}
@keyframes grandBlink {
    0%,100%{ color:#FFD700; }
    50%{ color:#FF4500; }
}
#scratchCanvas {
    width: 90vw;
    max-width: 320px;
    aspect-ratio: 1/1;
    border-radius: 50%;
}
#offer {
    position:absolute;
    width:90vw;
    max-width:320px;
    aspect-ratio:1/1;
    top:0;
    left:50%;
    transform:translateX(-50%);
    display:flex;
    align-items:center;
    justify-content:center;
    text-align:center;
    background:#FFF8DC;
    border-radius:50%;
    font-weight:bold;
    font-size:3rem;
    z-index:1;
}
#afterScratchConditionBox {
    display:none;
    position:fixed;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    padding:20px;
    background:#fff;
    border:3px solid #FFD700;
    border-radius:12px;
    text-align:center;
    z-index:9999;
    width:90%;
    max-width:350px;
}
</style>
</head>
<body>
<header>Welcome To Lifestyle Shirva!</header>

<!-- First Screen -->
<div class="dashboard" id="firstScreen">
    <input type="text" id="billNo" placeholder="Enter Your Bill Number" onblur="fetchBillData()">
    <input type="text" id="billAmt" placeholder="Bill Amount" readonly>
    <input type="text" id="mobile" placeholder="Mobile Number" readonly>
    <input type="text" id="custName" placeholder="Customer Name" readonly>
    <button id="proceedBtn" onclick="proceed()">Proceed</button>
    <div id="msg" class="message"></div>
    <div id="firstScreenConditionBox">
        <span id="condCustName"></span>
        <span id="condBillNo"></span>
        <span id="condBillAmt"></span>
        <span id="condCouponCode"></span>
        <span id="condWinningGift"></span>
    </div>
</div>

<!-- Second Screen -->
<div class="scratch-container" id="secondScreen">
    <div class="header-text">Scratch & WinüèÜ</div>
    <div style="position:relative;">
        <canvas id="scratchCanvas" width="300" height="300"></canvas>
        <div id="offer"></div>
    </div>
    <div class="footer-text">¬© 2025 Life Style Shirva üíñ</div>
    <div id="afterScratchConditionBox">
        <h1>üåü Congratulations! üåü</h1>
        <span id="afterCustName"></span>
        <span id="afterBillNo"></span>
        <span id="afterBillAmt"></span>
        <span id="winningInfo"></span>
        <span id="couponCodeInfo"></span>
        <span id="scratchDateTime"></span>
        <a href="#" id="whatsappButton">Send to WhatsApp</a>
    </div>
</div>

<script>
let usedBills = JSON.parse(localStorage.getItem('usedBills') || '[]');
function saveUsedBills(){ localStorage.setItem('usedBills', JSON.stringify(usedBills)); }
let currentBill = null;

// Fetch bill data
async function fetchBillData(){
    const billNo=document.getElementById('billNo').value.trim();
    if(!billNo) return;
    try{
        const res=await fetch("https://bill-4rh.pages.dev/bills.json",{cache:"no-store"});
        const data=await res.json();
        const found=(data.bills||[]).find(b=>b.billNo===billNo);
        if(!found){ document.getElementById('msg').innerText="‚ùå Bill not found"; currentBill=null; return; }
        document.getElementById('billAmt').value=found.payable||found.amount||"";
        document.getElementById('mobile').value=found.mobile||"";
        document.getElementById('custName').value=found.name||"";
        currentBill=found;
    }catch(e){ document.getElementById('msg').innerText="‚ö†Ô∏è Error loading"; }
}

// Proceed button
function proceed(){
    const msg=document.getElementById('msg');
    msg.innerText="";
    if(!currentBill){ msg.innerText="‚ö†Ô∏è Invalid Bill"; return; }
    let used=usedBills.find(b=>b.billNo===currentBill.billNo);
    if(used){
        msg.innerText="‚ùå Already used!";
        const box=document.getElementById('firstScreenConditionBox');
        box.style.display='block';
        document.getElementById('condCustName').innerText=`Customer: ${used.name}`;
        document.getElementById('condBillNo').innerText=`Bill: ${used.billNo}`;
        document.getElementById('condBillAmt').innerText=`Amount: ‚Çπ${used.billAmt}`;
        document.getElementById('condCouponCode').innerText=`Coupon: ${used.coupon}`;
        document.getElementById('condWinningGift').innerText=`Prize: ${used.gift}`;
        return;
    }
    const pay=parseFloat(currentBill.payable||currentBill.amount||"0");
    if(pay<1000){ msg.innerText="‚ö†Ô∏è Scratch not available"; return; }
    document.getElementById('firstScreen').style.display="none";
    document.getElementById('secondScreen').style.display="flex";
}

// Scratch logic
const canvas=document.getElementById('scratchCanvas');const ctx=canvas.getContext('2d');const offer=document.getElementById('offer');
let isDrawing=false,revealed=false;
function scratch(e){const r=canvas.getBoundingClientRect();const x=(e.touches?e.touches[0].clientX:e.clientX)-r.left;const y=(e.touches?e.touches[0].clientY:e.clientY)-r.top;ctx.globalCompositeOperation='destination-out';ctx.beginPath();ctx.arc(x,y,20,0,Math.PI*2);ctx.fill();}
canvas.addEventListener('pointerdown',()=>isDrawing=true);
canvas.addEventListener('pointermove',e=>{if(isDrawing&&!revealed)scratch(e)});
canvas.addEventListener('pointerup',()=>{if(!revealed){revealFull();}isDrawing=false;});

function generateCouponCode(){return 'LS-'+Math.random().toString(36).substring(2,8).toUpperCase();}
function getCurrentDateTime(){return new Date().toLocaleString();}
function updateWhatsAppButton(g,c,dt){const n=document.getElementById('custName').value;const b=currentBill.billNo;const a=document.getElementById('billAmt').value;const msg=`Hi,\nCustomer: ${n}\nBill: ${b}\nAmount: ‚Çπ${a}\nPrize: ${g}\nCode: ${c}\nDate: ${dt}`;document.getElementById('whatsappButton').href=`https://wa.me/918431270716?text=${encodeURIComponent(msg)}`;}

function revealFull(){
    revealed=true;ctx.clearRect(0,0,canvas.width,canvas.height);
    const gifts=['üí∞50 ‚Çπ Cashback','üéÅ Gift Item','üí∞100 ‚Çπ Cashback'];const g=gifts[Math.floor(Math.random()*gifts.length)];
    offer.innerText=g;
    const c=generateCouponCode();const dt=getCurrentDateTime();
    document.getElementById('afterCustName').innerText=`Customer: ${currentBill.name}`;
    document.getElementById('afterBillNo').innerText=`Bill: ${currentBill.billNo}`;
    document.getElementById('afterBillAmt').innerText=`Amount: ‚Çπ${currentBill.payable||currentBill.amount}`;
    document.getElementById('winningInfo').innerText=`You Won: ${g}`;
    document.getElementById('couponCodeInfo').innerText=`Coupon: ${c}`;
    document.getElementById('scratchDateTime').innerText=`Date: ${dt}`;
    document.getElementById('afterScratchConditionBox').style.display='block';
    updateWhatsAppButton(g,c,dt);
    usedBills.push({billNo:currentBill.billNo,name:currentBill.name,billAmt:currentBill.payable||currentBill.amount,gift:g,coupon:c});saveUsedBills();
}
ctx.fillStyle='silver';ctx.fillRect(0,0,canvas.width,canvas.height);ctx.font='bold 18px Arial';ctx.fillStyle='black';ctx.textAlign='center';ctx.fillText('SCRATCH HERE üéâ',canvas.width/2,canvas.height/2);
</script>
</body>
</html>
